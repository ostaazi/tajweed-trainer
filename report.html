<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tajweedy â€” ØªÙ‚Ø±ÙŠØ± Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <header>
      <img src="assets/logo-tajweedy.png" alt="Tajweedy" onerror="this.style.display='none'">
      <div>
        <h1>Tajweedy â€” ØªÙ‚Ø±ÙŠØ± Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
        <div class="muted">Ù…Ù„Ø®Ù‘Øµ Ø¯Ù‚ÙŠÙ‚ Ù„Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ù…Ø¹ Ø§Ù„Ø­ÙƒÙ… Ø¹Ù„Ù‰ ÙƒÙ„ Ø³Ø¤Ø§Ù„</div>
      </div>
      <div class="toolbar" style="margin-inline-start:auto;display:flex;gap:8px">
        <button class="btn" onclick="toggleTheme()">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</button>
        <button class="btn" onclick="copyReport()">Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
        <button class="btn" onclick="window.print()">ØªÙ†Ø²ÙŠÙ„/Ø·Ø¨Ø§Ø¹Ø©</button>
      </div>
    </header>

    <section class="card" id="metaCard"></section>

    <section class="card">
      <table class="table" id="tbl">
        <thead>
          <tr>
            <th class="center" style="width:54px">#</th>
            <th>Ø§Ù„Ø³Ø¤Ø§Ù„</th>
            <th style="width:140px">Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ</th>
            <th style="width:120px">Ø§Ù„ØµØ­ÙŠØ­</th>
            <th class="center" style="width:70px">Ø§Ù„Ø­ÙÙƒÙ…</th>
            <th>Ù„Ù…Ø§Ø°Ø§ØŸ</th>
          </tr>
        </thead>
        <tbody id="tbody"><tr><td colspan="6" class="center muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.</td></tr></tbody>
      </table>
      <div class="row" style="justify-content:flex-end;margin-top:10px">
        <button class="btn" onclick="copyReport()">Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
        <button class="btn" onclick="window.print()">ØªÙ†Ø²ÙŠÙ„/Ø·Ø¨Ø§Ø¹Ø©</button>
      </div>
      <div class="muted" style="margin-top:10px">* ØªØ¹Ø±Ø¶ Ø®Ù„ÙŠØ© <strong>Ø§Ù„Ø­ÙÙƒÙ…</strong> Ø±Ù…Ø² âœ… Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ùˆ âŒ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£.</div>
    </section>
  </div>

<script>
function toggleTheme(){ const d=document.documentElement; d.dataset.theme = d.dataset.theme==='dark' ? '' : 'dark'; }
function getReport(){
  if (window.reportData && window.reportData.items) return window.reportData;
  try{
    const raw = localStorage.getItem('tajweedy_last_report')
             || localStorage.getItem('tajweed_last_report');
    if (!raw) return null;
    const obj = JSON.parse(raw);
    if (obj && Array.isArray(obj.items)) return obj;
  }catch(e){}
  const now=new Date().toISOString();
  return { traineeName:"Ù…ØªØ¯Ø±Ù‘Ø¨", sectionLabel:"Ø§Ù„Ù†ÙˆÙ† Ø§Ù„Ø³Ø§ÙƒÙ†Ø© ÙˆØ§Ù„ØªÙ†ÙˆÙŠÙ†", score:{correct:1,total:5}, takenAt:now, items:[
    { no:1, question:"Ù…Ø§ Ø­ÙƒÙ… Ø§Ù„ØªÙ†ÙˆÙŠÙ†ØŸ (Ø§Ù„Ù…Ø«Ø§Ù„: Ù…ÙÙ†Ù’ Ø¢Ù…Ù†)", options:["Ø¥Ø¸Ù‡Ø§Ø±","Ø¥Ø¯ØºØ§Ù… Ø¨ØºÙ†Ø©","Ø¥Ù‚Ù„Ø§Ø¨","Ø¥Ø®ÙØ§Ø¡"], chosen:"Ø¥Ø¸Ù‡Ø§Ø±", answer:"Ø¥Ø¯ØºØ§Ù… Ø¨ØºÙ†Ø©", isCorrect:false, rationale:"Ø¥Ø¯ØºØ§Ù… Ø¨ØºÙ†Ø© Ø¥Ø°Ø§ ØªØ¨Ø¹Øª Ø§Ù„Ù†ÙˆÙ†/Ø§Ù„ØªÙ†ÙˆÙŠÙ† Ø£Ø­Ø¯ Ø­Ø±ÙˆÙ ÙŠÙ†Ù…Ùˆ."}
  ]};
}
function fillMeta(r){
  const el=document.getElementById('metaCard'); const date=new Date(r.takenAt||Date.now());
  el.innerHTML = `<div class="row" style="justify-content:space-between">
    <div class="row"><span class="badge">Ø§Ù„Ù‚Ø³Ù…: ${r.sectionLabel||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span><span class="badge">Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${r.score?.correct||0} / ${r.score?.total||0}</span></div>
    <div class="row">${r.traineeName?`<span class="badge">ğŸ‘¤ ${r.traineeName}</span>`:''}<span class="badge">ğŸ—“ï¸ ${date.toLocaleString('ar')}</span></div>
  </div>`;
}
function fillTable(r){
  const body=document.getElementById('tbody');
  if(!r.items || !r.items.length){ body.innerHTML = `<tr><td colspan="6" class="center muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.</td></tr>`; return; }
  body.innerHTML = r.items.map(it=>{
    const icon = it.isCorrect ? 'âœ…' : 'âŒ';
    const cls  = it.isCorrect ? 'ok' : 'bad';
    const chosen = (it.chosen ?? '').toString();
    const answer = (it.answer ?? '').toString();
    const highlight = (txt, needle, ok)=>{
      if(!txt || !needle) return txt;
      try{ const esc=needle.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
        return txt.replace(new RegExp(`(${esc})`,'g'), `<mark style="background:${ok?'#dcfce7':'#fee2e2'};padding:0 4px;border-radius:4px">${needle}</mark>`);
      }catch(e){return txt;}
    };
    return `<tr>
      <td class="center">${it.no ?? ''}</td>
      <td>${it.question || ''}</td>
      <td>${highlight(chosen, chosen, it.isCorrect)}</td>
      <td>${highlight(answer, answer, true)}</td>
      <td class="center ${cls}">${icon}</td>
      <td><span class="muted">${it.rationale || ''}</span></td>
    </tr>`;
  }).join('');
}
function copyReport(){
  const sel = window.getSelection(); const range = document.createRange();
  range.selectNode(document.getElementById('tbl')); sel.removeAllRanges(); sel.addRange(range);
  try{ document.execCommand('copy'); sel.removeAllRanges(); alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©.'); }
  catch(e){ sel.removeAllRanges(); navigator.clipboard?.writeText(document.getElementById('tbl').innerText).then(()=>alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ.')).catch(()=>alert('âš ï¸ ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.')); }
}
(function(){ const r=getReport(); fillMeta(r); fillTable(r); })();
</script>
</body>
</html>
